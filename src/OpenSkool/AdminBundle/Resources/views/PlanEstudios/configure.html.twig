{% extends base_template %}

{% block navbar_title %}{{ admin.toString(object)|truncate(50) }}{% endblock %}

{% block actions %}
    <li>{% include 'SonataAdminBundle:Button:show_button.html.twig' %}</li>
    <li>{% include 'SonataAdminBundle:Button:edit_button.html.twig' %}</li>
    {#<li>{% include 'SonataAdminBundle:Button:history_button.html.twig' %}</li>#}
    <li>{% include 'SonataAdminBundle:Button:list_button.html.twig' %}</li>
    <li>{% include 'SonataAdminBundle:Button:create_button.html.twig' %}</li>
{% endblock %}

{% block tab_menu %}
    {{ knp_menu_render(admin.sidemenu(action), {
    'currentClass' : 'active',
    'template': admin_pool.getTemplate('tab_menu_template')
    }, 'twig') }}
{% endblock %}

{% block content %}

    {% embed '@OpenSkoolAdmin/tabs.html.twig' %}

        {% from '@OpenSkoolAdmin/tabs.html.twig' import tab, content %}
        {% use '@OpenSkoolAdmin/PlanEstudios/etapas.html.twig' %}

        {% block header -%}
            {{ tab('tab_etapas', 'Etapas', true) }}
            {{ tab('tab_grupos', 'Grupos') }}
        {%- endblock %}

        {% block body -%}

            {{ content('tab_etapas', block('etapas'), true) }}
            {{ content('tab_grupos', block('grupos')) }}

        {%- endblock %}

        {% block grupos %}
            Info de los grupos del sistema <b>Que bien</b>
        {% endblock %}

    {% endembed %}

    {% embed '@OpenSkoolAdmin/modal.html.twig' with {id: 'add-etapa-modal', show_close: true, size: 'sm'} %}
        {% block header %}Agregar Etapa{% endblock %}
        {% block content %}
            <div id="add-etapa-ajax"></div>{% endblock %}
    {% endembed %}

    <div id="data-ajax"></div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            $('#list-etapas').sortable({
                axis: 'y',
                items: '> li.active',
                cursor: 'move',
                update: function () {
                    var pos = 0;
                    $('#list-etapas').find('.list-group-item').each(function () {
                        $(this).find('input.orden').val(pos++);
                    });
                }
            }).on('click', '.etapa-link', function (e) {
                e.preventDefault();
                $.get($(this).attr('href')).done(function (html) {
                    $("#list-etapas").html($($.parseHTML(html)).find('#list-etapas').html());
                });
            });
            $('#reordenar-etapas').on('click', function (e) {
                e.preventDefault();
                $.get('{{ admin.generateObjectUrl('ordenar_etapas', object) }}?' + $('input.orden:hidden').serialize());
            });
            $('#add-etapa').on('click', function (e) {
                e.preventDefault();
                $("#add-etapa-ajax").load($(this).attr('href'), function () {
                    $("#add-etapa-modal").modal().trigger('sonata-admin-append-form-element');
                });
            });
        });
    </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .list-group-item.active { cursor: n-resize; }

        .list-group-item.inactive {
            /*cursor: no-drop;*/
            background-color: #F9F9F9;
            color: #999;
        }
    </style>
{% endblock %}
